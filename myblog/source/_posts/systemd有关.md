---
layout: ä¸€äº› 
title: systemd
date: 2025-04-05 14:59:22
tags:
---

å¥½çš„ï¼æˆ‘ä»¬æ¥æŠŠ Linux ä¸­ **systemd æœåŠ¡çš„çŠ¶æ€** è®²å¾—æ¸…æ¸…æ¥šæ¥šï¼ŒåŒ…æ‹¬å®ƒçš„å‡ ä¸ªä¸»è¦ **çŠ¶æ€åˆ†ç±»**ã€æ¯ä¸ªå­—æ®µçš„æ„ä¹‰ã€å¸¸è§çš„çŠ¶æ€ç»„åˆï¼Œå¹¶ä¸”å¸¦ä¸Š**å›¾è§£é£æ ¼æ€ç»´å¯¼å›¾å¼åˆ†ç±»**ğŸ‘‡

---

## ğŸ§± ä¸€ã€æœåŠ¡çŠ¶æ€çš„ 3 ä¸ªå…³é”®å­—æ®µï¼ˆåœ¨ `systemctl` ä¸­ï¼‰

| å­—æ®µ | æ„ä¹‰ | ä¸¾ä¾‹ |
|------|------|------|
| **LOAD** | æ˜¯å¦æˆåŠŸåŠ è½½äº† unit æ–‡ä»¶ | `loaded` / `not-found` |
| **ACTIVE** | é«˜å±‚æ¬¡çš„æ´»è·ƒçŠ¶æ€ï¼ˆæ˜¯å¦æ­£åœ¨å·¥ä½œï¼‰ | `active` / `inactive` / `failed` |
| **SUB** | å…·ä½“çš„å­çŠ¶æ€ï¼Œæè¿°æœåŠ¡çš„è¿è¡Œç»†èŠ‚ | `running` / `exited` / `dead` |

---

## ğŸ§© äºŒã€æœåŠ¡çŠ¶æ€åˆ†ç±»ï¼ˆæ€ç»´å¯¼å›¾é£æ ¼ï¼‰

```
æœåŠ¡çŠ¶æ€ (systemctl list-units)
â”œâ”€â”€ LOAD
â”‚   â”œâ”€â”€ loaded         # unit æ–‡ä»¶å·²æˆåŠŸåŠ è½½
â”‚   â”œâ”€â”€ not-found      # unit æ–‡ä»¶ä¸å­˜åœ¨
â”‚   â””â”€â”€ bad-setting    # é…ç½®é”™è¯¯
â”‚
â”œâ”€â”€ ACTIVE
â”‚   â”œâ”€â”€ active         # æœåŠ¡æ­£å¸¸è¿è¡Œä¸­
â”‚   â”œâ”€â”€ inactive       # æ²¡æœ‰è¿è¡Œ
â”‚   â”œâ”€â”€ activating     # æ­£åœ¨å¯åŠ¨ä¸­
â”‚   â”œâ”€â”€ deactivating   # æ­£åœ¨å…³é—­ä¸­
â”‚   â””â”€â”€ failed         # å¯åŠ¨å¤±è´¥
â”‚
â””â”€â”€ SUB
    â”œâ”€â”€ running        # æ­£å¸¸è¿è¡Œä¸­ï¼ˆæŒç»­è¿›ç¨‹ï¼‰
    â”œâ”€â”€ exited         # å¯åŠ¨åç«‹å³é€€å‡ºï¼ˆçŸ­ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚ä¸€æ¬¡æ€§è„šæœ¬ï¼‰
    â”œâ”€â”€ waiting        # å®ˆæŠ¤è¿›ç¨‹ç­‰å¾…äº‹ä»¶è§¦å‘ï¼ˆå¸¸è§äº socket æœåŠ¡ï¼‰
    â”œâ”€â”€ dead           # æ²¡æœ‰æ´»åŠ¨è¿›ç¨‹
    â””â”€â”€ auto-restart   # æ­£åœ¨å°è¯•è‡ªåŠ¨é‡å¯ï¼ˆRestart=alwaysï¼‰
```

---

## ğŸ§  ä¸‰ã€å¸¸è§çŠ¶æ€ç»„åˆï¼ˆ`systemctl list-units`ï¼‰

| LOAD     | ACTIVE   | SUB        | è¯´æ˜ |
|----------|----------|------------|------|
| loaded   | active   | running    | âœ… æ­£å¸¸è¿è¡Œä¸­ï¼ˆå¦‚ sshã€nginxï¼‰ |
| loaded   | active   | exited     | âœ… è¿è¡Œåé€€å‡ºï¼ˆå¦‚ä¸€æ¬¡æ€§ä»»åŠ¡ï¼‰ |
| loaded   | inactive | dead       | âš ï¸ æœªå¯åŠ¨æœåŠ¡ä½†é…ç½®æ²¡é—®é¢˜ |
| loaded   | failed   | failed     | âŒ å¯åŠ¨å¤±è´¥ï¼Œå¯æŸ¥æ—¥å¿— |
| not-found| inactive | dead       | âŒ unit æ–‡ä»¶éƒ½æ‰¾ä¸åˆ° |
| loaded   | active   | waiting    | ğŸ’¤ å®ˆå€™ä¸­ï¼ˆå¦‚ socket è§¦å‘æœåŠ¡ï¼‰ |

---

## ğŸ”§ å››ã€å¦‚ä½•æ’æŸ¥å¼‚å¸¸çŠ¶æ€

| çŠ¶æ€ | åŸå› åˆ†æ | æ’æŸ¥æ–¹æ³• |
|------|----------|----------|
| `failed` | å¯åŠ¨å¤±è´¥ | `journalctl -xe` æˆ– `systemctl status æœåŠ¡å` |
| `exited` | è„šæœ¬ç±»æœåŠ¡æ‰§è¡Œå®Œé€€å‡ºï¼ˆæ­£å¸¸ï¼‰ | æŸ¥çœ‹æ˜¯å¦éœ€è¦æŒä¹…è¿è¡Œ |
| `inactive` | æ²¡å¯åŠ¨æˆ–è¢«åœæ­¢äº† | `systemctl start æœåŠ¡å` å¯åŠ¨å®ƒ |
| `masked` | è¢«ç®¡ç†å‘˜ç¦ç”¨å¯åŠ¨äº† | `sudo systemctl unmask æœåŠ¡å` è§£é” |

---

## ğŸ¯ äº”ã€æŸ¥çœ‹å•ä¸ªæœåŠ¡çŠ¶æ€ï¼ˆå‘½ä»¤ï¼‰

```bash
systemctl status nginx
```

è¾“å‡ºåŒ…æ‹¬ï¼š

- Loaded: æ–‡ä»¶è·¯å¾„
- Active: çŠ¶æ€ + æ—¶é—´
- Process: PID ç­‰ä¿¡æ¯
- æ—¥å¿—ç‰‡æ®µï¼ˆç±»ä¼¼ tailï¼‰

---

## âœ… ä¾‹å­è®²è§£ï¼š`systemctl status ssh`

```
â— ssh.service - OpenBSD Secure Shell server
   Loaded: loaded (/lib/systemd/system/ssh.service; enabled)
   Active: active (running) since ...
 Main PID: 938
```

è¯´æ˜ï¼š
- Unit æ–‡ä»¶æˆåŠŸåŠ è½½ï¼ˆloadedï¼‰
- å½“å‰æ­£åœ¨è¿è¡Œï¼ˆactiveï¼‰
- æ˜¯æŒç»­æœåŠ¡ï¼ˆsub: runningï¼‰
- è®¾ç½®äº†å¼€æœºè‡ªå¯ï¼ˆenabledï¼‰

---

å¦‚æœä½ å‘æˆ‘ä¸€æ¡ä½ æœºå™¨ä¸Š `systemctl status xxx` çš„è¾“å‡ºï¼Œæˆ‘å¯ä»¥å¸®ä½ è¯»æ‡‚å®ƒçš„çŠ¶æ€å’Œå»ºè®®æ€ä¹ˆå¤„ç†ï½æ˜¯å¦è¦æˆ‘ä¹Ÿç”»å¼ å°å›¾å¸®åŠ©ä½ è®°å¿†è¿™å‡ ä¸ªçŠ¶æ€å…³ç³»ï¼Ÿ
